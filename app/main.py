from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.interseptor.ratelimiter import RateLimitMiddleware

from app.routes.interfaceData import router as interfaceData
from app.routes.healthCheck import router as healthCheck
from app.routes.publicApiData import router as publicApiData
from app.routes.awsToy import router as awsToy

import os

TIMEOUT_SEC = float(os.getenv("TIMEOUT_SEC", "5.0"))

routers = [interfaceData, healthCheck, publicApiData, awsToy]

# FastAPI 앱 객체 생성
app = FastAPI()

# CORS 설정
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# ✅ Rate Limiting 인터셉터 등록
app.add_middleware(RateLimitMiddleware, max_requests=30, window_sec=60)

# 디버깅용 루트 엔드포인트
@app.get("/")
def root():
    return {
        "status": "ok",
        "env": {k: os.environ.get(k) for k in [
            "SF_CLIENT_ID", "SF_CLIENT_SECRET", "SF_LOGIN_URL", "SF_API_VERSION", "API_KEY", "SFDC_URL"
        ]}
    }

# 라우터 등록
for router in routers:
    app.include_router(router)

# def setBody():
#     paramMap = {
#     "248,000,000원": {
#         "냉장고(150만원)": {
#             "미션오일1회,냉각수1회)포함": {
#                 "황원일010-9175-2812": "3,300,000 원 원"
#             }
#         }
#     },
#     "259,000,000원": {
#         "세이프티패키지(ACC,EBA,LGS,ESP)": {
#             "미션오일1회,냉각수1회)포함": {
#                 "황원일010-9175-2812": "32,300,000 원"
#             }
#         }
#     },
#     "279,000,000원": {
#         "디스크브레이크,노그리스타입조인트": {
#             "미션오일1회,냉각수1회)포함": {
#                 "황원일010-9175-2812": "21,500,000 원"
#             }
#         }
#     },
#     "290,000,000원*CARE": {
#         "FREE5yrs(엔진오일및필터류5회,기어오일1회,": {
#             "미션오일1회,냉각수1회)포함": {
#                 "황원일010-9175-2812": "32,600,000 원"
#             }
#         }
#     },
#     "309,000,000원*": {
#         "CAREFREE4yrs(엔진오일및필터4회,기어오일,미션오일,": {
#             "옵션냉각수교환)포함": {
#                 "황원일010-9175-2812": "31,400,000 원"
#             }
#         }
#     },
#     "319,000,000원*": {
#         "CFX5yrs(엔진오일및필터2년무제한)": {
#             "12,000,000원": {
#                 "황원일010-9175-2812": "32,200,000 원"
#             }
#         }
#     },
#     "336,000,000원*": {
#         "CFX4yrs(엔진오일및필터2년무제한)": {
#             "1,000,000원": {
#                 "황원일010-9175-2812": "34,900,000 원"
#             }
#         }
#     },
#     "341,000,000원": {
#         "네비게이션(80만원)": {
#             "1,500,000원": {
#                 "판매자": "47,300,000 원"
#             }
#         }
#     },
#     "319,000,000원": {
#         "MAN무시동에어컨": {
#             "3,000,000원": {
#                 "판매자": "50,000,000 원"
#             }
#         }
#     },
#     "344,000,000원": {
#         "루프스포일러&사이드디플렉터": {
#             "5,000,000원": {
#                 "판매자": "54,200,000 원"
#             }
#         }
#     },
#     "가격": {
#         "옵션": {
#             "옵션가격": {
#                 "판매자": "주유상품권"
#             }
#         }
#     },
#     "출고시금액(계약금,인도금,인지대,탁송료)": "98,335,000 원",
#     "부대비용": {
#         "부대비용계": "75,000 원",
#         "탁송료공증료(책임보험료포함)인지대": "협 의 75,000 원"
#     },
#     "할부내역": {
#         "월할부금": {
#             "월할부금(84개월)": "3,358,400 원",
#             "만파이낸스(1~3등급)": {
#                 "할부이자율": "5.60%"
#             },
#             "월할부금(60개월)월할부금(72개월)": "4,460,200 원 3,816,700 원"
#         },
#         "할부금융사": {
#             "만파이낸스(1~3등급)": {
#                 "할부이자율": "5.60%"
#             }
#         }
#     },
#     "인도비용": {
#         "부가세액포함대출금액": "259,800,000 원",
#         "대출금액": "232,940,000 원",
#         "인도금액합계": "62,560,000 원",
#         "부가세대출금액(할부금융)": "26,860,000 원"
#     },
#     "상품권": {
#         "계약금액(상품권할인금액)": "35,700,000 원",
#         "주유상품권할인후현금": "49,179,000 원",
#         "할인율": "0.03",
#         "주유상품권": "50,700,000 원"
#     },
#     "시책": {
#         "Promotion5Promotion6": "가죽시트, 바닥매트",
#         "Promotion4": "CARE FREE 5yrs( 동력전달계통5년75만km 보증, 엔진오일및필터5년5회) 시510만원추가",
#         "Promotion3": "출고기념품세트 - 100 (측면썬바이저, 엔진오일 5L, 점퍼, 티셔츠, 가방)",
#         "Promotion2": "CFX 5yrs( 동력전달계통5년75만km 보증, 엔진오일및필터6년)",
#         "Promotion1": "주유상품권 (5,070만)"
#     },
#     "차량가격": {
#         "실판매가격(부가세포함)": "295,500,000 원",
#         "선택사양7": {
#             "P.T.O주유상품권": "1,500,000 원"
#         },
#         "선택사양6": {
#             "루프스포일러": "3,000,000 원"
#         },
#         "선택사양5": {
#             "LED라이트및LCD계기판": "기본적용"
#         },
#         "선택사양4": {
#             "*CFX5yrs(엔진오일및필터2년무제한)": "12,000,000 원"
#         },
#         "선택사양3": {
#             "디스크브레이크,노그리스타입조인트": "기본적용"
#         },
#         "선택사양2": {
#             "세이프티패키지(ACC,EBA,LGS,ESP)": "기본적용"
#         },
#         "선택사양1": {
#             "12단자동변속기,인타더브레이크": "기본적용"
#         },
#         "차량가격": "279,000,000 원"
#     },
#     "차종": "TGX 28.510 6X2-2 BL SA GM 3300"

#     }

def run():
    print("서버 구동완료...")

if __name__ == "__main__":
    print("서버 구동중")
    run()


